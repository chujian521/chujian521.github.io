

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/dandan.png">
  <link rel="icon" href="/images/dandan.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Encounter">
  <meta name="keywords" content="">
  
    <meta name="description" content="继续进行OWASP TOP 10部分的内容的学习，上半部分对前四种类型的分类进行了学习记录，这次继续对后面几种类型进行学习">
<meta property="og:type" content="article">
<meta property="og:title" content="OWASP-Top-10-for-2021-学习笔记（下）">
<meta property="og:url" content="https://chujian521.github.io/blog/2022/10/17/OWASP-Top-10-for-2021-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/index.html">
<meta property="og:site_name" content="X&#39;s blog">
<meta property="og:description" content="继续进行OWASP TOP 10部分的内容的学习，上半部分对前四种类型的分类进行了学习记录，这次继续对后面几种类型进行学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chujian521.github.io/images/fj35.jpg">
<meta property="og:image" content="https://chujian521.github.io/images/ssrf.png">
<meta property="article:published_time" content="2022-10-17T08:46:35.000Z">
<meta property="article:modified_time" content="2023-03-01T13:51:49.153Z">
<meta property="article:author" content="Encounter">
<meta property="article:tag" content="Web安全">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://chujian521.github.io/images/fj35.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>OWASP-Top-10-for-2021-学习笔记（下） - X&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"chujian521.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":80,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"88d6a072634686f804175a1f3d287260","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?88d6a072634686f804175a1f3d287260";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>X&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="OWASP-Top-10-for-2021-学习笔记（下）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-10-17 16:46" pubdate>
          2022年10月17日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          67 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">OWASP-Top-10-for-2021-学习笔记（下）</h1>
            
            
              <div class="markdown-body">
                
                <p><strong>继续进行OWASP TOP 10部分的内容的学习，上半部分对前四种类型的分类进行了学习记录，这次继续对后面几种类型进行学习</strong></p>
<p><img src="/images/fj35.jpg" srcset="/img/loading.gif" lazyload></p>
<span id="more"></span>

<h2 id="A05-安全设定缺陷"><a href="#A05-安全设定缺陷" class="headerlink" title="A05 安全设定缺陷"></a>A05 安全设定缺陷</h2><h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>从2017版本中的第六名上升至2021最新版本中的第五名，90%的应用程序都被测试出各类明显的设定缺陷。随着越来越多的高度可配置软件出现，此类别的上升并不让人意外。与此类相对应的CWE包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/16.html">CWE-16：配置 </a>：此类别中的弱点通常在软件配置期间引入。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/611.html">CWE-611：对 XML 外部实体引用的不当限制</a>：软件处理一个 XML 文档，该文档可能包含具有 URI 的 XML 实体，这些 URI 解析为预期控制范围之外的文档，从而导致产品在其输出中嵌入不正确的文档。（缓解措施：可以将许多 XML 分析器和验证程序配置为禁用外部实体扩展。）</li>
</ul>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>如果程序包含以下几个因素，则有可能容易受到攻击：</p>
<ul>
<li>在应用程序堆栈的任意部分缺少适当的安全加固，或者在云服务上配置了不适当的权限。</li>
<li>不必要的功能被安装或者启用（比如不必要的端口、服务、页面、账户或者是权限）</li>
<li>默认的账户和密码仍然是可用状态并且未作修改。</li>
<li>错误处理向用户显示堆栈跟踪或其他信息过多的错误消息。</li>
<li>对于已经升级的系统，之前的安全特性被禁用或者是没有安全地配置。</li>
<li>应用服务、框架、库和数据库等的安全设置没有被设定成安全的值。</li>
<li>服务器不发送安全头或指令，或者没有将它们设置为安全值。</li>
<li>软件版本太旧或者本身存在漏洞。</li>
</ul>
<p>如果没有一致的、可重复的应用程序安全配置流程，系统将面临更高的风险。</p>
<h3 id="如何预防"><a href="#如何预防" class="headerlink" title="如何预防"></a>如何预防</h3><p>应实施安全的安装过程，包括:</p>
<ul>
<li>可重复的安全加固过程使部署另一个适当锁定的环境变得快速和容易。开发、QA和生产环境都应该配置相同，在每个环境中使用不同的凭证。这个过程应该是自动化的，以减少设置新的安全环境所需的工作量。</li>
<li>一个最小的平台，没有任何不必要的特性、组件、文档和示例。删除或不安装不使用的特性和框架。</li>
<li>作为补丁管理过程的一部分，审查和更新适用于所有安全注释、更新和补丁的配置的任务，检查云存储权限（例如S3（Simple Storage Service，简单存储服务）存储桶，（S3为任意类型的文件提供临时或永久的存储服务。用于存储图片、视频、音乐和文档。S3是专为大型，非结构化的数据块设计的））</li>
<li>分段的应用程序体系结构通过分段、容器化或云安全组(ACL)在组件或租户之间提供有效和安全的分离。</li>
<li>向客户端发送安全指令，例如，安全头。</li>
<li>在所有环境中验证配置和设置有效性的自动化过程。</li>
</ul>
<h3 id="攻击实例"><a href="#攻击实例" class="headerlink" title="攻击实例"></a>攻击实例</h3><p><strong>情境 #1:</strong> 已经上线的程序服务器带有预设的样本程序没有移除，这个样本程序带有已知的安全缺陷，可被攻击者利用入侵服务器。比如预设的程序带有管理员页面，并且没有修改默认的管理员账号密码，攻击者可以使用预设的密码登录，并获得控制权。</p>
<p><strong>情境 #2:</strong> 数据文件目录查看权限并未在服务器上关闭。攻击者可以找出并且下载已编译过 Java 代码，并且通过反编译与逆向工程等手法，查看原始代码。再通过源代码找出应用程序中严重的存取控制缺陷。</p>
<p><strong>情境 #3:</strong> 程序服务器的设定中允许输出带有详细内容的错误信息，例如堆栈追踪，供用户查看。这有可能导致敏感讯息的外泄，或间接透露出使用中并带有脆弱性的组件版本。</p>
<p><strong>情境 #4:</strong> 一个云端服务器，给其他在网际网路的 CSP 用户提供了预设权限分享，这将导致云端储存的敏感资料可以被存取。</p>
<h2 id="A06-危险或过旧的组件"><a href="#A06-危险或过旧的组件" class="headerlink" title="A06 危险或过旧的组件"></a>A06 危险或过旧的组件</h2><h3 id="简述-1"><a href="#简述-1" class="headerlink" title="简述"></a>简述</h3><p>该弱点在产业调查中排名第二，有足够的资料让它进入前十。易受攻击的组件是我们努力测试和评估风险的已知问题，该弱点是在CWEs中唯一没有任何CVE对应的类别。著名的CWE包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/1104.html">CWE-1104：使用未经维护的第三方组件</a>：产品依赖于第三方组件，这些组件不受原始开发人员或原始开发人员的受信任代理的积极支持或维护。</li>
</ul>
<h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>可能容易受到的攻击：</p>
<ul>
<li>如果不知道所使用的所有组件的版本(包括客户端和服务器端)。所有组件包括您直接使用的组件以及嵌套依赖项。</li>
<li>如果软件是有漏洞的，不受支持的或者是老旧的。这包括操作系统、Web应用或服务器，数据库管理系统（DBMS）、应用、APIs以及所有的组件、运行时环境和库。</li>
<li>如果没有定期扫描漏洞并订阅与所使用组件相关的安全公告。</li>
<li>如果没有以基于风险的、及时的方式修复或者升级底层平台、框架或者依赖项。这种情况通常发生在修补是变更控制下的每月或每季度的任务，会导致面临几天或者几个月的固定漏洞的不必要的暴露。</li>
<li>如果软件开发人员不测试更新、升级或打了补丁的库的兼容性。</li>
<li>如果您不保护组件的配置（A05）</li>
</ul>
<h3 id="如何预防-1"><a href="#如何预防-1" class="headerlink" title="如何预防"></a>如何预防</h3><p>以下场景应该有补丁管理流程：</p>
<ul>
<li>移除未使用的依赖、不必要的功能、组件、文件和文档。</li>
<li>使用versions、OWASP Dependency Check、retirement .js等工具，持续盘点客户端和服务器端组件(如框架、库)的版本及其依赖性。持续监控组件中的漏洞来源，如常见漏洞和披露(CVE)和国家漏洞数据库(NVD)。使用软件组合分析工具来实现过程的自动化。订阅与所使用组件相关的安全漏洞的电子邮件警报。</li>
<li>只能通过安全链接从官方来源获取组件。最好使用签名包，以减少包含修改过的恶意组件的机会（A08）。</li>
<li>监视未维护或未为旧版本创建安全补丁的库和组件。如果不可能打补丁，请考虑部署虚拟补丁来监视、检测或保护所发现的问题。</li>
</ul>
<p>每个组织都必须确保为应用程序或项目组合的生命周期制定监视、分类和应用更新或配置更改的持续计划。</p>
<h3 id="攻击实例-1"><a href="#攻击实例-1" class="headerlink" title="攻击实例"></a>攻击实例</h3><p><strong>情境 #1：</strong>组件通常是以与应用程序相同的权限去运行，因此任何组件中的缺陷都可能导致严重的后果。这种缺陷可能是偶然的（比如编程时的错误）或者是故意的（例如组件中的后门）</p>
<ul>
<li>CVE-2017-5638：一个 Struts 2 远端程式码执行漏洞，可以在服务器上执行任意代码，已被归咎于重大漏洞。</li>
<li>虽然物联网 (IoT) 设备通常很难或无法修补，但修补它们可能很重要。 （例如，生物医学设备）。</li>
</ul>
<p>有一些自动化工具可以帮助攻击者找到未修补或配置错误的系统。例如，Shodan IoT 搜索引擎可以帮助您找到存在 2014 年 4 月未修补 Heartbleed 漏洞的设备。</p>
<h2 id="A07-认证及验证机制失效"><a href="#A07-认证及验证机制失效" class="headerlink" title="A07 认证及验证机制失效"></a>A07 认证及验证机制失效</h2><h3 id="简述-2"><a href="#简述-2" class="headerlink" title="简述"></a>简述</h3><p>之前被称为“被破坏的身份验证”，该类别从第二名下滑至第八名，其中著名的CWE包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/297.html">CWE-297：对证书的不正确验证，主机不匹配</a>：软件与提供证书的主机通信，但软件无法正确确保证书实际与该主机关联。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/287.html">CWE-287：不正确的身份验证</a>：当参与者声称具有给定的身份时，该软件不会证明或不充分证明该声明是正确的。例如：服务器没有限制登录尝试次数 、使用客户端不受信任的参数作为登录成功的标识。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/384.html">CWE-384： 会话固定</a>：在不使任何现有会话标识符无效的情况下对用户进行身份验证或以其他方式建立新的用户会话，使攻击者有机会窃取经过身份验证的会话。</li>
</ul>
<h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>确认用户的身份、身份验证和会话管理对于防止与身份验证相关的攻击至关重要。如果应用程序满足以下条件，则可能存在身份验证弱点：</p>
<ul>
<li>允许自动攻击，例如凭据填充，其中攻击者拥有有效用户名和密码的列表。</li>
<li>允许暴力破解或者其他自动攻击。</li>
<li>使用默认的、强度弱的或者众所周知的密码，比如“admin&#x2F;admin”</li>
<li>使用弱或者无效的凭据恢复和忘记密码的过程，例如“基于知识的答案”，这些过程无法确保安全。</li>
<li>使用纯文本、加密或弱哈希密码数据存储</li>
<li>具有缺失或者无效的多重身份认证</li>
<li>在URL中公开会话标识符</li>
<li>成功登录后重用会话标识符</li>
<li>不能正确的让会话ID失效。用户会话或身份验证令牌在注销或者处于非活动状态期间不会正确失效。</li>
</ul>
<h3 id="如何预防-2"><a href="#如何预防-2" class="headerlink" title="如何预防"></a>如何预防</h3><ul>
<li>如果可能，请实施多重身份验证，以防止自动凭据填充、暴力破解和凭据被盗重用攻击。</li>
<li>不要使用任何默认凭据进行交付或部署，特别是对于管理员用户。</li>
<li>实施弱密码检查，例如针对前 10，000 个最差密码列表测试新密码或已更改密码。</li>
<li>使密码长度、复杂性和轮换策略与美国国家标准与技术研究院 （NIST） 800-63b 在 5.1.1 节中针对“记住的机密”或其他基于证据的现代密码策略的指南保持一致。</li>
<li>通过对所有消息结果使用相同的消息，确保注册、凭据恢复等对帐户枚举攻击进行强化</li>
<li>限制或者逐渐延迟失败登录的尝试，但是注意不能拒绝服务。记录所有的错误，并在检测到撞库、暴力破解或者其他攻击时向管理员发出警报。</li>
<li>使用服务器端、安全的内置会话管理器，该管理器在登录后生成具有高熵值的新随机会话ID。会话标识符不应位于URL中，应安全存储，并在注销、空闲和绝对超时后失效。</li>
</ul>
<h3 id="攻击实例-2"><a href="#攻击实例-2" class="headerlink" title="攻击实例"></a>攻击实例</h3><p><strong>场景 #1：</strong>凭据填充，即使用已知密码列表，是一种常见的攻击。假设应用程序未实现自动威胁或撞库保护。在这种情况下，应用程序可以用作密码预言机，以确定凭据是否有效。</p>
<p><strong>场景 #2：</strong>大多数身份验证攻击是由于持续使用密码作为唯一因素而发生的。一旦被认为是最佳实践，密码轮换和复杂性要求就会鼓励用户使用和重用弱密码。建议组织根据 NIST 800-63 停止这些做法，并使用多重身份验证。</p>
<p><strong>场景 #3：</strong>应用程序会话超时设置不正确。用户使用公共计算机访问应用程序。用户无需选择“注销”，只需关闭浏览器选项卡即可离开。攻击者在一小时后使用相同的浏览器，并且用户仍经过身份验证。</p>
<h2 id="A08-软件和数据完整性失效"><a href="#A08-软件和数据完整性失效" class="headerlink" title="A08 软件和数据完整性失效"></a>A08 软件和数据完整性失效</h2><h3 id="简述-3"><a href="#简述-3" class="headerlink" title="简述"></a>简述</h3><p>2021年新增的类别，侧重于在不验证完整性的情况下做出与软件更新、关键数据和CI&#x2F;CD管道相关的假设。著名的CWE包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/829.html">CWE-829：包含来自不受信任的控制领域的功能 </a>：软件从预期控制范围之外的源导入、要求或包含可执行功能（如库）。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/494.html">CWE-494：下载不进行完整性检查的代码 </a>：产品从远程位置下载源代码或可执行文件并执行代码，而无需充分验证代码的来源和完整性。攻击者可以通过破坏主机服务器、执行 DNS 欺骗或修改传输中的代码来执行恶意代码。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/502.html">CWE-502：不可信数据的反序列化</a>：应用程序会反序列化不受信任的数据，而无需充分验证生成的数据是否有效。</li>
</ul>
<h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>软件和数据完整性故障与无法防止完整性违规的代码和基础结构有关。</p>
<p>这方面的一个例子是，应用程序依赖于来自不受信任的源、存储库和内容交付网络 （CDN） 的插件、库或模块。不安全的 CI&#x2F;CD 管道可能会引入未经授权的访问、恶意代码或系统危害的可能性。最后，许多应用程序现在都包含自动更新功能，其中更新在没有充分完整性验证的情况下下载并应用于以前受信任的应用程序。攻击者可能会上传自己的更新，以便在所有安装上分发和运行。</p>
<p>另一个示例是，对象或数据被编码或序列化为一个结构，攻击者可以看到和修改该结构容易受到不安全的反序列化的影响。</p>
<h3 id="如何预防-3"><a href="#如何预防-3" class="headerlink" title="如何预防"></a>如何预防</h3><ul>
<li>使用数字签名或者类似的机制来验证软件或者数据是否来自预期的源且没有被更改。</li>
<li>确保库和依赖项（如npm或者maven）正在使用受信任的存储库。</li>
<li>确保使用软件供应链安全工具（如OWASP依赖关系检查）来验证组件是否不包含已知漏洞。</li>
<li>确保有代码和配置更改的审查过程，以最大限度地减少恶意代码或者配置被引入软件管道的可能性</li>
<li>确保CI&#x2F;CD管道具有适当的隔离、配置和访问控制，以确保流经生成和部署过程的代码的完整性</li>
<li>确保未签名或未加密的序列化数据不会在没有某种形式的完整性检查或数字签名的情况下发送到不受信任的客户端，以检测序列化数据的篡改或重放</li>
</ul>
<h3 id="攻击实例-3"><a href="#攻击实例-3" class="headerlink" title="攻击实例"></a>攻击实例</h3><p><strong>情境 #1 不带签名的更新：</strong>许多家用路由器、机顶盒、设备固件等不通过签名固件验证更新。未签名的固件是攻击者不断增长的目标，预计只会变得更糟。这是一个主要问题，因为很多时候，除了在将来的版本中修复并等待以前的版本老化之外，没有其他机制可以修复。</p>
<p><strong>情境 #2 不安全的反序列化</strong>：一个反应式应用程序调用 Spring Boot 微服务。程序设计师们试图确保他们的代码是不可变的。他们的解决方案是在双向所有请求讯息中包含序列化的用户状态。攻击者注意到“R00”Java 对象签名（在base64中）并使用 Java Serial Killer 工具(用来执行 Java 反序列化攻击)在应用程序服务器上获取远程代码执行权限。</p>
<p><strong>情境 #3 SolarWinds 恶意更新</strong>：众所周知，某些国家会攻击更新机制，最近一次值得注意的是对 SolarWinds Orion 的攻击。该软体开发商拥有安全构建和更新完整性流程。尽管如此，这些流程仍被破坏并在几个月时间中向 18,000 多个组织送出高度针对性的恶意更新，其中大约 100 个组织受到了影响。这是历史上这一性质影响最深远和最重要的破坏之一。</p>
<h2 id="A09-安全日志和监控失效"><a href="#A09-安全日志和监控失效" class="headerlink" title="A09 安全日志和监控失效"></a>A09 安全日志和监控失效</h2><h3 id="简述-4"><a href="#简述-4" class="headerlink" title="简述"></a>简述</h3><p>安全记录及监控是业界调查结果 (#3)，由 2017 年的第十名稍微上升一名。记录及监控功能验证非常有挑战性，通常需要以访谈或询问的方式检验有无侦测渗透测试的攻击活动。此类别的CVE &#x2F; CVSS数据不多，但检测和响应违规行为至关重要。尽管如此，它对问责制，可见性，事件警报和取证可能非常有影响力。著名的CWE包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/778.html">CWE-778：日志记录不足</a>：当发生安全关键事件时，软件要么不记录事件，要么在记录事件时省略有关事件的重要详细信息。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/117.html">CWE-117：日志的输出处理不正确</a>：软件不会处理或错误地处理写入日志的输出。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/223.html">CWE-223：遗漏安全相关信息</a>：应用程序不会记录或显示对于识别攻击的来源或性质或确定操作是否安全非常重要的信息。</li>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/532.html">CWE-532：在日志文件中插入敏感信息</a>：写入日志文件的信息可能具有敏感性质，可为攻击者提供有价值的指导或公开敏感的用户信息。</li>
</ul>
<h3 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h3><p>此类别旨在帮助检测，升级和响应活动的违规行为。如果没有日志记录和监视，则无法检测到违规行为。日志记录、检测、监视和主动响应不足，在以下情况下可能会发生：</p>
<ul>
<li>不会记录可审核的事件，如登录、失败的登录和高价值事务。</li>
<li>警告和错误不会生成、不充分或不明确的日志消息。</li>
<li>不会监视应用程序和 API 的日志是否存在可疑活动。</li>
<li>日志仅存储在本地。</li>
<li>适当的警报阈值和响应升级过程尚未到位或无效。</li>
<li>动态应用程序安全测试 （DAST） 工具（如 OWASP ZAP）的渗透测试和扫描不会触发警报。</li>
<li>应用程序无法实时或近乎实时地对主动攻击检测、升级或发出警报。</li>
</ul>
<p>如果日志记录和警报事件对用户或攻击者可见，还会容易受到信息泄漏的影响（参阅A01：无效的访问控制）</p>
<h3 id="如何预防-4"><a href="#如何预防-4" class="headerlink" title="如何预防"></a>如何预防</h3><p>取决于应用风险，开发人员应实现以下部分或者全部控件：</p>
<ul>
<li>确保所有登录、访问控制和服务器端输入验证失败都可以记录在足够的用户上下文中，以识别可疑或恶意帐户，并保留足够的时间以允许延迟取证分析。</li>
<li>确保日志管理解决方案可以轻松使用的格式来生成日志</li>
<li>确保日志格式数据编码正确，以防止日志记录或监视系统进行注入或攻击。</li>
<li>确保高价值事务具有完整性控制的审计跟踪，以防止篡改或者删除，例如使用append-only数据库表</li>
<li>DevSecOps 团队应建立有效的监视和警报，以便快速检测和响应可疑活动。</li>
<li>建立或采用事件响应和恢复计划，例如美国国家标准与技术研究院 （NIST） 800-61r2 或更高版本。</li>
</ul>
<p>有一些商业的或者开源的应用保护框架例如OWASP ModSecurity Core Rule Set，以及开源的日志关联软件，例如Elasticsearch, Logstash, Kibana (ELK) stack，拥有功能自定义仪表盘和警报。</p>
<h3 id="攻击实例-4"><a href="#攻击实例-4" class="headerlink" title="攻击实例"></a>攻击实例</h3><p><strong>场景 #1：</strong>由于缺乏监控和日志记录，儿童健康计划提供商的网站运营商无法检测到违规行为。外部方通知健康计划提供者，攻击者访问并修改了超过 350 万名儿童的数千份敏感健康记录。事后审查发现，网站开发人员尚未解决重大漏洞。由于没有对系统进行日志记录或监控，数据泄露可能自2013年以来一直在进行，为期七年多。</p>
<p><strong>场景 #2：</strong>印度一家大型航空公司的数据泄露涉及数百万乘客十多年的个人数据，包括护照和信用卡数据。数据泄露发生在第三方云托管提供商处，该提供商在一段时间后通知了航空公司。</p>
<p><strong>场景 #3：</strong>一家大型欧洲航空公司遭受了GDPR应报告的违规行为。据报道，该漏洞是由攻击者利用的支付应用程序安全漏洞引起的，攻击者收集了超过400，000条客户支付记录。该航空公司因此被隐私监管机构罚款2000万英镑。</p>
<h2 id="A10-服务端请求伪造（SSRF）"><a href="#A10-服务端请求伪造（SSRF）" class="headerlink" title="A10 服务端请求伪造（SSRF）"></a>A10 服务端请求伪造（SSRF）</h2><h3 id="简述-5"><a href="#简述-5" class="headerlink" title="简述"></a>简述</h3><p>此类别是从前 10 名社区调查 （#1） 中添加的。数据显示，发生率相对较低，测试覆盖率高于平均水平，漏洞利用和影响潜在评级高于平均水平。CWE示例如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cwe.mitre.org/data/definitions/918.html">CWE-918： 服务器端请求伪造</a>：Web 服务器从上游组件接收 URL 或类似请求，并检索此 URL 的内容，但它不能充分确保将请求发送到预期的目标。</li>
</ul>
<h3 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h3><p>每当 Web 应用程序在未验证用户提供的 URL 的情况下获取远程资源时，就会发生 SSRF漏洞。它允许攻击者强制应用程序将精心编制的请求发送到意外的目标，即使受到防火墙、VPN 或其他类型的网络访问控制列表 （ACL） 的保护也是如此。</p>
<p>由于现代 Web 应用程序为最终用户提供了方便的功能，因此获取 URL 成为一种常见方案。因此，SSRF的发生率正在增加。此外，由于云服务和架构的复杂性，SSRF的严重性越来越高。</p>
<p>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。</p>
<p><img src="/images/ssrf.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="如何预防-5"><a href="#如何预防-5" class="headerlink" title="如何预防"></a>如何预防</h3><p>开发人员可以通过实现以下部分或全部深度防御控制来阻止 SSRF：</p>
<h4 id="从网络层"><a href="#从网络层" class="headerlink" title="从网络层"></a>从网络层</h4><ul>
<li>将远程资源访问功能分段到单独网络中，减少SSRF的影响</li>
<li>强制实施“默认拒绝”防火墙策略或网络访问控制规则，以阻止除基本 Intranet 流量之外的所有流量。<ul>
<li>根据应用程序建立防火墙规则的所有权和生命周期</li>
<li>记录防火墙上所有已接受和阻止的网络流</li>
</ul>
</li>
</ul>
<h4 id="从应用层"><a href="#从应用层" class="headerlink" title="从应用层"></a>从应用层</h4><ul>
<li>清理并验证所有客户输入的数据</li>
<li>使用白名单强制实施URL协议、端口和目标</li>
<li>不要向客户端发送原始响应数据。</li>
<li>禁用HTTP重定向</li>
<li>注意URL一致性，以避免诸如DNS重新绑定和“检查时间，使用时间”（TOCTOU）竞争条件之类的攻击</li>
</ul>
<p>不要通过使用黑名单或正则表达式来缓解 SSRF。攻击者拥有有效负载列表、工具和技能来绕过黑名单。</p>
<h4 id="其他措施"><a href="#其他措施" class="headerlink" title="其他措施"></a>其他措施</h4><ul>
<li>不要在前端系统上部署其他与安全相关的服务（例如OpenID）。控制这些系统上的本地流量（例如本地主机）</li>
<li>对于具有专用和可管理用户组的前端，在独立系统上使用网络加密来考虑非常高的保护需求。</li>
</ul>
<h3 id="攻击实例-5"><a href="#攻击实例-5" class="headerlink" title="攻击实例"></a>攻击实例</h3><p>攻击者可以使用 SSRF 攻击受 Web 应用程序防火墙、防火墙或网络 ACL 保护的系统，使用以下方案：</p>
<p><strong>场景 #1：</strong>端口扫描内部服务器 – 如果网络体系结构未分段，攻击者可以绘制出内部网络，并根据连接结果或连接或拒绝 SSRF 有效负载连接所用的时间确定内部服务器上的端口是打开还是关闭。</p>
<p><strong>场景 #2：</strong>敏感数据泄露 – 攻击者可以访问本地文件或内部服务以获取敏感信息，例如 <code>file:///etc/passwd</code>和<code>http://localhost:28017/</code> 。</p>
<p><strong>场景 #3：</strong>访问云服务的元数据存储 – 大多数云提供商都有元数据存储，例如 <code>http://169.254.169.254/</code>。攻击者可以读取元数据以获取敏感信息。</p>
<p><strong>场景 #4：</strong>危害内部服务 – 攻击者可以滥用内部服务进行进一步的攻击，例如远程执行代码 （RCE） 或拒绝服务 （DoS）。</p>
<h3 id="SSRF常用的几种协议"><a href="#SSRF常用的几种协议" class="headerlink" title="SSRF常用的几种协议"></a>SSRF常用的几种协议</h3><h4 id="file"><a href="#file" class="headerlink" title="file"></a>file</h4><p>使用file协议可以尝试进行的任意文件读取，file协议的格式为：file:&#x2F;&#x2F;文件路径</p>
<h4 id="http"><a href="#http" class="headerlink" title="http"></a>http</h4><p>向目标发送http请求，由于get请求的参数是直接加在url里的，所以可以探测内网那些使用get请求即可攻击的应用。</p>
<h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><p>dict协议与http协议可用来探测内网的主机存活与端口开放情况。dict协议不支持换行符，没有办法进行换行，相当于一次只能执行一条命令，所以不能用来攻击那些需要交互的应用（比如需要认证的redis）。</p>
<h4 id="Gopher"><a href="#Gopher" class="headerlink" title="Gopher"></a>Gopher</h4><p>Gopher是Internet上一个非常有名的信息查找系统，它将Internet 上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处如果发起post请求，回车换行需要使用%0d%0a，如果多个参数，参数之间的&amp;也需要进行URL编码<br>在SSRF中经常会使用Gopher来构造GET&#x2F;POST包攻击应用。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Web%E5%AE%89%E5%85%A8/">#Web安全</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>OWASP-Top-10-for-2021-学习笔记（下）</div>
      <div>https://chujian521.github.io/blog/2022/10/17/OWASP-Top-10-for-2021-学习笔记（下）/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Encounter</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年10月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2022/10/27/CSRF%E3%80%81XSS%E3%80%81SSRF%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85/" title="CSRF、XSS、SSRF傻傻分不清">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CSRF、XSS、SSRF傻傻分不清</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2022/10/15/%E4%BB%80%E4%B9%88%E6%98%AFNginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="什么是Nginx反向代理">
                        <span class="hidden-mobile">什么是Nginx反向代理</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="SOHUCS" sid='https://chujian521.github.io/blog/2022/10/17/OWASP-Top-10-for-2021-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/'></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#SOHUCS', function() {
      Fluid.utils.createScript("https://changyan.sohu.com/upload/changyan.js", function() {
        window.changyan.api.config({"appid":"cywkrFUjM","appkey":"4ccd03889a49ffa3059780af8bbbc0e2"})
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
  <!--浏览器整蛊标题-->
  <script type="text/javascript" src="\js\funnyTitle.js"></script>
  <!--动态线条背景-->
  <script type="text/javascript"
    color="255,69,0" opacity='0.7' zIndex="-1" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
  </script>
  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":300,"height":600},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
